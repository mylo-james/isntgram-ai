# Story 1.9: Demo Mode Access

**Status**: In Progress

## Story

**As a recruiter**, I want a "Try our demo" button on the login page, so that I can instantly access the application
without registering.

## Acceptance Criteria

1. A "Try our demo" button is clearly visible on the `/login` page.
2. Clicking the button logs the user in as a pre-defined, read-only demo user without requiring a password (no user
   input required).
3. The demo user session is established, and the user is redirected to the app experience. For Phase 1, redirect to `/`
   (home) or the demo user's profile at `/[username]` is acceptable, as the main feed is not yet implemented.
4. The demo user account exists in the database with realistic profile information and placeholder stats. Deeper seeded
   content (posts, followers) will be handled in Epic 2/3.
5. Demo mode restrictions are enforced (read-only): editing profile, following users, creating content, or other
   mutating actions are disabled for the demo user. The UI indicates demo mode when restrictions are encountered.

## Tasks / Subtasks

- [ ] **Task 1: Create Demo User Account** (AC: 4)
  - [ ] Create demo user account in database (non-privileged, read-only role/flag)
  - [ ] Ensure demo user has realistic profile information and placeholder counts
  - [ ] Add an idempotent seed function/script to ensure demo user exists in dev/test/prod
  - [ ] Add environment variables for demo user configuration (email, username, full name, optional password)

- [ ] **Task 2: Add Demo Button to Login Page** (AC: 1)
  - [ ] Add "Try our demo" button to `apps/web/app/login/page.tsx`
  - [ ] Style button to be prominent and clearly visible
  - [ ] Position button appropriately in login page layout
  - [ ] Add hover effects and accessibility features
  - [ ] Ensure button works on mobile and desktop

- [ ] **Task 3: Implement Demo Authentication** (AC: 2, 3)
  - [ ] Option A: Create backend endpoint `POST /api/auth/demo` that returns the demo user for Auth.js sign-in
  - [ ] Option B: Implement a dedicated Auth.js provider for demo sign-in and call `signIn("demo")` from the button
  - [ ] Frontend: wire the login page button to perform demo sign-in without user input
  - [ ] Ensure redirect to `/` or `/<demo-username>` for Phase 1
  - [ ] Add loading states and error handling

- [ ] **Task 4: Create Demo Data Seeding** (AC: 4)
  - [ ] Create idempotent seed for demo user (profile and placeholder counts)
  - [ ] Defer posts/follows/comments seeding to Epics 2/3; add TODO references to those stories
  - [ ] Ensure demo data is realistic and clearly labeled when applicable

- [ ] **Task 5: Implement Demo Session Management** (AC: 3, 5)
  - [ ] Add demo session handling in Auth.js callbacks (mark user as demo via token/session claim)
  - [ ] Implement demo user state management in Redux (e.g., `isDemoUser` flag)
  - [ ] Add demo user identification in UI components (badge/tooltip)
  - [ ] Add demo session expiration and cleanup
  - [ ] Add demo mode indicator in navigation or profile header

- [ ] **Task 6: Add Demo Mode Restrictions** (AC: 5)
  - [ ] Implement read-only restrictions for demo user across UI (e.g., disable Edit Profile, Follow, etc.)
  - [ ] Add demo mode warnings for restricted actions (non-blocking toasts/tooltips)
  - [ ] Create demo mode UI indicators
  - [ ] Add demo mode help/tooltip information

- [ ] **Task 7: Create Comprehensive Tests** (Testing Requirements)
  - [ ] Create `apps/web/app/login/page.test.tsx` tests for demo button and redirect
  - [ ] Test demo authentication flow and session creation (unit/integration)
  - [ ] Test demo user identification and restrictions in UI components (e.g., `EditProfileModal` and `ProfileActions`)
  - [ ] Create backend API tests for demo authentication (if Option A)
  - [ ] Add E2E test for demo sign-in flow (Playwright)

---

### Cross-Story Gap Closure for Phase 1

- [ ] CI/CD gap: Implement GHCR container push in CI (Epic 1.3)
  - [ ] Configure GHCR auth and repository secrets
  - [ ] Push images on main branch builds with tags: commit SHA, latest
  - [ ] Keep existing Trivy and SBOM steps
- [ ] Testing parity: Story 1.6 listed integration tests under `apps/web/test/â€¦`; current coverage is via Playwright E2E
      and unit tests
  - [ ] Add a minimal web integration test (or document E2E coverage as the chosen strategy) to fully satisfy stated AC
- [ ] Post-login redirect consistency
  - [ ] For Phase 1, confirm redirect target (home `/` vs. `/<username>`) and align tests/docs/code

## Dev Notes

### Previous Story Insights

- Story 1.8 completed edit profile functionality with form validation
- User profile management and update capabilities implemented
- Authentication system fully functional with Auth.js integration
- Profile page with dynamic routing and user data display completed

### Current State Verification (2025-08-11)

- `/login` implemented with credentials sign-in and redirect to `/` on success; no demo button yet
- Auth.js configured with credentials provider; no demo provider/endpoint yet
- Users API provides `GET /users/:username`, `GET /users/me`, `GET /users/check-username/:username`,
  `PUT /users/profile`
- Edit Profile flow implemented and tested; username uniqueness checks in place
- Tests: 30/30 suites passing across web/api/shared; Playwright e2e auth flow present (`e2e/auth.test.ts`)
- CI pipeline includes lint/type, tests, integration, E2E, production build with Trivy and SBOM; GHCR push not yet
  configured

### Data Models

**Demo User Configuration**:

```typescript
export interface DemoUser {
  id: string;
  username: string;
  fullName: string;
  email: string;
  profilePictureUrl: string;
  bio: string;
  isDemoUser: boolean;
  demoData: {
    posts: DemoPost[];
    followers: string[];
    following: string[];
  };
}
```

### API Endpoints

- `POST /api/auth/demo` - Authenticate as demo user (Option A)
- `GET /api/demo/data` - Get demo user data and relationships (defer to Epics 2/3)
- `POST /api/demo/reset` - Reset demo user data (for testing; optional for Phase 1)

### Key Dependencies

- Auth.js for demo session management
- Database seed for demo user creation
- Redux for demo user state management
- Tailwind CSS for demo button styling
- React Testing Library and Playwright for testing

## Testing

- Unit tests for demo authentication and session management
- Integration tests for demo endpoint (Option A) and UI restrictions
- E2E tests with Playwright for complete demo flow
- Test coverage requirements: 80% for new code
- Test demo mode restrictions and UI indicators

## Change Log

| Date                                                           | Version           | Description                                                                        | Author             |
| -------------------------------------------------------------- | ----------------- | ---------------------------------------------------------------------------------- | ------------------ |
| 2025-01-XX                                                     | 1.0               | Initial story creation                                                             | Bob (Scrum Master) |
| 2025-08-11                                                     | 1.1               | Updated AC for Phase 1 reality; added tasks for demo sign-in, session flagging, UI |
| restrictions; captured CI/CD and testing gaps to close Phase 1 | James (Dev Agent) |

## Dev Agent Record

### Agent Model Used

Full Stack Developer (James) - Expert Senior Software Engineer & Implementation Specialist

### Debug Log References

- Verified current implementation and tests: all Jest suites passing; E2E auth flow passing
- Confirmed absence of demo sign-in and demo UI restrictions; identified GHCR push gap in CI

### Completion Notes List

- Pending: Demo sign-in button, provider/endpoint, session flagging, UI restrictions, tests
- Pending: GHCR push in CI; small testing parity note for Story 1.6 integration tests vs. E2E

### File List

- `apps/web/app/login/page.tsx` (add demo button and wiring)
- `apps/web/lib/auth.ts` (add demo provider/callback or handling)
- `apps/api/src/auth/` (optional: `POST /auth/demo` endpoint)
- `apps/api/src/users/` (seed function for demo user)
- `apps/web/app/[username]/components/ProfileActions.tsx` and `components/profile/EditProfileModal.tsx` (demo
  restrictions)
