# Story 1.8: Edit Profile Functionality

**Status**: Approved

## Story

**As a logged-in user**, I want to edit my profile information, so that I can keep my details up to date.

## Acceptance Criteria

1. Clicking the "Edit Profile" button opens a modal or navigates to an edit page containing fields for my full name and
   username.
2. The form is pre-populated with my current data.
3. The form has validation to prevent submitting empty fields or a username that is already taken.
4. Submitting the form successfully updates the user's information in the database.
5. The profile page reflects the updated information upon successful submission.

## Tasks / Subtasks

- [ ] **Task 1: Create Edit Profile Modal/Page** (AC: 1)
  - [ ] Create `apps/web/components/profile/EditProfileModal.tsx` component
  - [ ] Design modal with form fields for full name and username
  - [ ] Add proper modal state management (open/close)
  - [ ] Implement responsive design for mobile and desktop
  - [ ] Add keyboard navigation and accessibility features

- [ ] **Task 2: Implement Form Pre-population** (AC: 2)
  - [ ] Fetch current user data when modal opens
  - [ ] Pre-populate form fields with existing user information
  - [ ] Handle loading states while fetching user data
  - [ ] Add error handling for data fetching failures
  - [ ] Implement form state management with React Hook Form

- [ ] **Task 3: Add Form Validation** (AC: 3)
  - [ ] Implement client-side validation for required fields
  - [ ] Add username uniqueness validation with backend check
  - [ ] Create real-time validation feedback for user input
  - [ ] Add validation error messages and styling
  - [ ] Implement form submission prevention for invalid data

- [ ] **Task 4: Create Backend Update Endpoint** (AC: 4)
  - [ ] Create `PUT /api/users/profile` endpoint in NestJS
  - [ ] Implement user profile update logic with validation
  - [ ] Add username uniqueness check in database
  - [ ] Create profile update DTOs and validation
  - [ ] Add proper error handling and response formatting

- [ ] **Task 5: Implement Form Submission** (AC: 4)
  - [ ] Create API client method for profile updates
  - [ ] Implement form submission with loading states
  - [ ] Add success and error handling for submission
  - [ ] Update Redux store with new user data
  - [ ] Add optimistic updates for better UX

- [ ] **Task 6: Update Profile Display** (AC: 5)
  - [ ] Refresh profile page data after successful update
  - [ ] Update Redux store with new user information
  - [ ] Implement real-time UI updates without page refresh
  - [ ] Add success notification for profile update
  - [ ] Handle navigation back to profile page

- [ ] **Task 7: Create Comprehensive Tests** (Testing Requirements)
  - [ ] Create `apps/web/components/profile/EditProfileModal.test.tsx`
  - [ ] Test form pre-population and validation
  - [ ] Test form submission and error handling
  - [ ] Create backend API tests for profile update endpoint
  - [ ] Test username uniqueness validation
  - [ ] Test integration with profile page updates

## Dev Notes

### Previous Story Insights

- Story 1.7 completed basic user profile page with dynamic routing
- User profile data fetching and display implemented
- Authentication-based UI differences (edit vs follow button) established
- Profile page error handling and 404 states implemented

### Data Models

**Profile Update DTO**:

```typescript
export interface UpdateProfileDto {
  fullName: string;
  username: string;
}

export interface ProfileUpdateResponse {
  success: boolean;
  user: UserProfile;
  message?: string;
}
```

### API Endpoints

- `PUT /api/users/profile` - Update current user's profile
- `GET /api/users/me` - Get current user's profile data
- `GET /api/users/check-username/[username]` - Check username availability

### Key Dependencies

- React Hook Form for form management and validation
- Redux for global state management
- Auth.js for user session and authentication
- Tailwind CSS for styling
- React Testing Library for component testing

## Testing

- Unit tests for edit profile modal and form validation
- Integration tests for profile update API
- E2E tests with Playwright for complete edit profile flow
- Test coverage requirements: 80% for new code
- Test form validation, submission, and error scenarios

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-XX | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

TBD

### Debug Log References

- TBD

### Completion Notes List

- TBD

### File List

- TBD
