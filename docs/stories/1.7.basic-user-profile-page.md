# Story 1.7: Basic User Profile Page

**Status**: Ready for Review

## Story

**As a logged-in user**, I want to view my own profile page and other users' profile pages, so that I can see basic user
information.

## Acceptance Criteria

1. A dynamic route `/[username]` is created to display user profiles.
2. The page fetches and displays the user's username, full name, and placeholders for post counts and follower/following
   stats.
3. When viewing my own profile, an "Edit Profile" button is visible.
4. When viewing another user's profile, a "Follow" button is visible (functionality for this button will be implemented
   in Epic 2).
5. The page displays a clear "User not found" message if the username in the URL does not exist.

## Tasks / Subtasks

- [x] **Task 1: Create Dynamic Route Structure** (AC: 1)
  - [x] Create `apps/web/app/[username]/page.tsx` dynamic route component
  - [x] Set up Next.js dynamic routing configuration
  - [x] Create route parameter validation and error handling
  - [x] Add proper TypeScript types for route parameters
  - [x] Implement route-level error boundaries

- [x] **Task 2: Create Profile Data Fetching** (AC: 2)
  - [x] Create `apps/web/lib/api-client.ts` methods for user profile fetching
  - [x] Implement `GET /api/users/[username]` endpoint in backend
  - [x] Add loading states and error handling for profile data
  - [x] Create user profile data models and interfaces
  - [x] Implement caching strategy for profile data

- [x] **Task 3: Create Profile Page UI** (AC: 2)
  - [x] Design and implement profile page layout with Tailwind CSS
  - [x] Display user avatar, username, and full name prominently
  - [x] Add placeholder sections for post counts and follower stats
  - [x] Create responsive design for mobile and desktop
  - [x] Add loading skeletons for better UX

- [x] **Task 4: Implement Profile Actions** (AC: 3, 4)
  - [x] Create "Edit Profile" button for own profile
  - [x] Create "Follow" button for other users' profiles
  - [x] Add proper authentication checks for action visibility
  - [x] Implement button states (loading, disabled, etc.)
  - [x] Add hover effects and accessibility features

- [x] **Task 5: Handle Error States** (AC: 5)
  - [x] Create "User not found" error page component
  - [x] Implement proper 404 handling for invalid usernames
  - [x] Add error boundaries for profile page failures
  - [x] Create user-friendly error messages
  - [x] Add navigation back to home or search

- [x] **Task 6: Create Backend Profile Endpoint** (AC: 2)
  - [x] Create `GET /api/users/[username]` endpoint in NestJS
  - [x] Implement user lookup by username
  - [x] Add proper error handling for non-existent users
  - [x] Create user profile DTOs and validation
  - [x] Add rate limiting and security measures

- [x] **Task 7: Create Comprehensive Tests** (Testing Requirements)
  - [x] Create `apps/web/app/[username]/page.test.tsx` with profile page tests
  - [x] Test profile data fetching and display
  - [x] Test error states and 404 handling
  - [x] Test authentication-based UI differences
  - [x] Create backend API tests for profile endpoint
  - [x] Test with various username formats and edge cases

## Dev Notes

### Previous Story Insights

- Story 1.6 completed frontend-backend authentication integration
- Auth.js session management and Redux state management implemented
- Protected routes and authentication flow established
- API client service with axios and error handling configured

### Data Models

**User Profile Interface**:

```typescript
export interface UserProfile {
  id: string;
  username: string;
  fullName: string;
  email: string;
  profilePictureUrl?: string;
  bio?: string;
  postCount: number;
  followerCount: number;
  followingCount: number;
  createdAt: Date;
  updatedAt: Date;
}
```

### API Endpoints

- `GET /api/users/[username]` - Fetch user profile by username
- `GET /api/users/me` - Get current user's profile (for edit button logic)

### Key Dependencies

- Next.js App Router for dynamic routing
- Auth.js for session management and user context
- Redux for global state management
- Tailwind CSS for styling
- React Testing Library for component testing

## Testing

- Unit tests for profile page component and API client
- Integration tests for profile data fetching
- E2E tests with Playwright for complete profile viewing flow
- Test coverage requirements: 80% for new code
- Test error states, loading states, and authentication scenarios

## Change Log

| Date       | Version | Description            | Author             |
| ---------- | ------- | ---------------------- | ------------------ |
| 2025-01-XX | 1.0     | Initial story creation | Bob (Scrum Master) |

## Dev Agent Record

### Agent Model Used

Full Stack Developer (James) - Expert Senior Software Engineer & Implementation Specialist

### Debug Log References

- Successfully created dynamic route structure with proper TypeScript types and error handling
- Implemented comprehensive profile data fetching with loading states and error handling
- Created responsive UI components with Tailwind CSS and proper accessibility features
- Built backend API endpoint with proper validation and error handling
- All tests passing (16/16 frontend tests, backend tests included)

### Completion Notes List

- ✅ Dynamic route `/[username]` created with proper parameter validation
- ✅ Profile page displays user avatar, username, full name, and stats prominently
- ✅ "Edit Profile" button shows for own profile, "Follow" button for others
- ✅ "User not found" error handling with navigation back to home
- ✅ Loading skeletons and error boundaries implemented
- ✅ Backend API endpoint `GET /api/users/[username]` with proper error handling
- ✅ Comprehensive test coverage for all components and scenarios
- ✅ Responsive design with mobile and desktop support
- ✅ Authentication-based UI differences properly implemented

### File List

**Frontend Files:**

- `apps/web/app/[username]/page.tsx` - Dynamic route component with metadata generation
- `apps/web/app/[username]/ProfilePage.tsx` - Main profile page component with data fetching
- `apps/web/app/[username]/ProfilePageSkeleton.tsx` - Loading skeleton component
- `apps/web/app/[username]/components/ProfileHeader.tsx` - Profile header with avatar and info
- `apps/web/app/[username]/components/ProfileStats.tsx` - Stats display component
- `apps/web/app/[username]/components/ProfileActions.tsx` - Action buttons component
- `apps/web/app/[username]/page.test.tsx` - Route component tests
- `apps/web/app/[username]/ProfilePage.test.tsx` - Profile page component tests
- `apps/web/components/common/ErrorBoundary.tsx` - Error boundary component
- `apps/web/lib/api-client.ts` - Updated with getUserProfile method

**Backend Files:**

- `apps/api/src/users/users.module.ts` - Users module configuration
- `apps/api/src/users/users.service.ts` - User service with profile methods
- `apps/api/src/users/users.controller.ts` - API controller for user endpoints
- `apps/api/src/users/users.service.test.ts` - Service tests
- `apps/api/src/users/users.controller.test.ts` - Controller tests
- `apps/api/src/app.module.ts` - Updated to include UsersModule
